<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Caminando con Cristo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lexend', sans-serif; background-color: #f3f4f6; overflow-x: hidden; }
        .view { min-height: 100vh; background: white; display: flex; flex-direction: column; width: 100%; }
        .hidden { display: none !important; }
        input[type="file"] { display: none; }
        .card-shadow { box-shadow: 0 4px 20px -2px rgba(0,0,0,0.05); }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="flex justify-center">

    <div id="app-container" class="w-full max-w-md bg-white min-h-screen shadow-2xl relative overflow-hidden flex flex-col">

        <section id="view-auth" class="view p-8 flex flex-col justify-center items-center fade-in">
            <div class="mb-8 text-center">
                <span class="material-symbols-outlined text-blue-600 text-7xl">account_circle</span>
                <h1 class="text-2xl font-bold mt-2 text-gray-800">Crear Cuenta</h1>
                <p class="text-gray-400 text-sm">Únete a la comunidad espiritual</p>
            </div>

            <div class="w-full space-y-4">
                <input type="email" id="input-email" placeholder="Correo electrónico" 
                    class="w-full bg-blue-50/50 border border-blue-100 p-4 rounded-xl outline-none focus:border-blue-500 transition-colors">
                
                <input type="password" id="input-password" placeholder="Crear contraseña" 
                    class="w-full bg-blue-50/50 border border-blue-100 p-4 rounded-xl outline-none focus:border-blue-500 transition-colors">

                <button onclick="validarRegistro()" 
                    class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg active:scale-95 transition-transform">
                    Registrarse Manualmente
                </button>
            </div>
        </section>

        <section id="view-setup" class="view hidden p-8 flex flex-col fade-in overflow-y-auto">
            <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">Completa tu Perfil</h2>

            <div class="flex flex-col items-center mb-6">
                <label for="file-upload" class="relative cursor-pointer">
                    <div id="avatar-preview" class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 overflow-hidden">
                        <span class="material-symbols-outlined text-gray-400 text-4xl">add_a_photo</span>
                    </div>
                </label>
                <input id="file-upload" type="file" accept="image/*" onchange="cargarFoto(event)">
                <p class="text-xs text-blue-600 font-bold mt-2">Toca para subir foto</p>
            </div>

            <div class="space-y-4 pb-6">
                <input type="text" id="setup-name" placeholder="Nombre completo" class="w-full bg-gray-50 border p-4 rounded-xl outline-none focus:border-blue-500">
                <input type="tel" id="setup-phone" placeholder="WhatsApp (ej: +54...)" class="w-full bg-gray-50 border p-4 rounded-xl outline-none focus:border-blue-500">

                <p class="text-xs font-bold text-gray-400 ml-1 mt-4">¿CUÁL ES TU ROL?</p>
                <div class="grid grid-cols-2 gap-3">
                    <div onclick="elegirRol('alumno')" id="btn-alumno" class="border-2 p-4 rounded-xl text-center font-bold text-gray-400 cursor-pointer transition-all">Alumno</div>
                    <div onclick="elegirRol('maestro')" id="btn-maestro" class="border-2 p-4 rounded-xl text-center font-bold text-gray-400 cursor-pointer transition-all">Maestro</div>
                </div>

                <div id="opcion-alumno" class="hidden animate-fade-in bg-blue-50 p-4 rounded-xl border border-blue-100">
                    <select id="select-maestro" class="w-full p-2 bg-white rounded-lg outline-none text-sm font-medium">
                        <option value="">Selecciona tu Maestro...</option>
                        <option value="Pastor Juan">Pastor Juan Carlos</option>
                        <option value="Maestra Elena">Maestra Elena</option>
                    </select>
                </div>

                <div id="opcion-maestro" class="hidden animate-fade-in bg-orange-50 p-4 rounded-xl border border-orange-100">
                    <input type="password" id="input-codigo" placeholder="Código de acceso (123)" class="w-full p-2 bg-white rounded-lg outline-none text-sm font-bold">
                </div>
            </div>

            <button onclick="guardarPerfil()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg mt-auto">
                Confirmar y Entrar
            </button>
        </section>

        <section id="view-home-alumno" class="view hidden">
            <header class="p-6 flex items-center justify-between border-b">
                <div class="flex items-center gap-3">
                    <div id="home-av-alumno" class="w-10 h-10 bg-blue-600 rounded-full overflow-hidden flex items-center justify-center text-white font-bold"></div>
                    <div>
                        <p id="home-name-alumno" class="font-bold text-sm leading-none"></p>
                        <p class="text-[10px] text-blue-500 font-bold uppercase mt-1">Alumno</p>
                    </div>
                </div>
                <button onclick="cerrarSesion()" class="text-gray-300"><span class="material-symbols-outlined">logout</span></button>
            </header>

            <div class="p-6 flex-1 overflow-y-auto pb-24">
                <h3 class="font-bold text-xl text-gray-800 mb-6">Mis Libros</h3>
                <div id="lista-libros" class="space-y-4"></div>
            </div>

            <nav class="absolute bottom-0 w-full h-20 bg-white border-t flex items-center justify-around">
                <div class="text-blue-600 flex flex-col items-center"><span class="material-symbols-outlined">auto_stories</span><span class="text-[10px] font-bold">Libros</span></div>
                <div class="text-gray-300 flex flex-col items-center"><span class="material-symbols-outlined">groups</span><span class="text-[10px] font-bold">Comunidad</span></div>
                <div class="text-gray-300 flex flex-col items-center"><span class="material-symbols-outlined">person</span><span class="text-[10px] font-bold">Perfil</span></div>
            </nav>
        </section>

        <section id="view-libro-detalle" class="view hidden">
            <header class="p-6 flex items-center border-b">
                <button onclick="irAHomeAlumno()" class="mr-4 text-gray-400"><span class="material-symbols-outlined">arrow_back</span></button>
                <h3 id="detalle-titulo" class="font-bold text-lg text-gray-800">Capítulos</h3>
            </header>
            <div id="lista-capitulos" class="p-6 space-y-3 overflow-y-auto flex-1"></div>
        </section>

        <section id="view-home-maestro" class="view hidden">
            <header class="p-6 flex items-center justify-between border-b bg-gray-50">
                <div class="flex items-center gap-3">
                    <div id="home-av-maestro" class="w-10 h-10 bg-orange-600 rounded-full overflow-hidden flex items-center justify-center text-white font-bold text-lg">M</div>
                    <p id="home-name-maestro" class="font-bold text-sm"></p>
                </div>
                <button onclick="cerrarSesion()" class="text-gray-300"><span class="material-symbols-outlined">logout</span></button>
            </header>
            <div class="p-6">
                <h3 class="font-bold text-xl text-gray-800 mb-4">Mis Alumnos</h3>
                <div class="bg-white p-4 rounded-2xl border border-orange-100 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gray-100 rounded-full"></div>
                        <div><p class="font-bold text-sm text-gray-700">Alumno de Prueba</p><p class="text-[10px] text-orange-500 font-bold uppercase">Pendiente</p></div>
                    </div>
                    <button class="bg-orange-500 text-white text-[10px] px-3 py-2 rounded-lg font-bold">CORREGIR</button>
                </div>
            </div>
        </section>

    </div>

    <script>
        let registro = { email: "", password: "", rol: "", nombre: "", telefono: "", foto: null, maestro: "" };

        // --- NAVEGACIÓN ---
        function cambiarVista(to) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(to).classList.remove('hidden');
        }

        // --- PASO 1: AUTH ---
        function validarRegistro() {
            const e = document.getElementById('input-email').value;
            const p = document.getElementById('input-password').value;
            if(!e || !p) return alert("Completa los datos");
            registro.email = e;
            registro.password = p;
            cambiarVista('view-setup');
        }

        // --- PASO 2: PERFIL ---
        function cargarFoto(event) {
            const reader = new FileReader();
            reader.onload = (e) => {
                registro.foto = e.target.result;
                document.getElementById('avatar-preview').innerHTML = `<img src="${registro.foto}" class="w-full h-full object-cover">`;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function elegirRol(r) {
            registro.rol = r;
            document.getElementById('btn-alumno').className = `border-2 p-4 rounded-xl text-center font-bold transition-all ${r==='alumno'?'border-blue-600 bg-blue-50 text-blue-600':'text-gray-400 border-gray-100'}`;
            document.getElementById('btn-maestro').className = `border-2 p-4 rounded-xl text-center font-bold transition-all ${r==='maestro'?'border-blue-600 bg-blue-50 text-blue-600':'text-gray-400 border-gray-100'}`;
            
            document.getElementById('opcion-alumno').classList.toggle('hidden', r !== 'alumno');
            document.getElementById('opcion-maestro').classList.toggle('hidden', r !== 'maestro');
        }

        function guardarPerfil() {
            const n = document.getElementById('setup-name').value;
            const t = document.getElementById('setup-phone').value;
            if(!n || !t || !registro.rol) return alert("Completa todo el perfil");

            if(registro.rol === 'alumno' && !document.getElementById('select-maestro').value) return alert("Elige un maestro");
            if(registro.rol === 'maestro' && document.getElementById('input-codigo').value !== '123') return alert("Código de maestro incorrecto");

            registro.nombre = n;
            registro.telefono = t;
            localStorage.setItem('usuario_cristo_db', JSON.stringify(registro));
            finalizarLogin();
        }

        // --- PASO 3: ENTRAR ---
        function finalizarLogin() {
            if(registro.rol === 'alumno') {
                document.getElementById('home-name-alumno').innerText = registro.nombre;
                const av = document.getElementById('home-av-alumno');
                if(registro.foto) av.innerHTML = `<img src="${registro.foto}" class="w-full h-full object-cover">`;
                else av.innerText = registro.nombre[0];
                renderLibros();
                cambiarVista('view-home-alumno');
            } else {
                document.getElementById('home-name-maestro').innerText = registro.nombre;
                cambiarVista('view-home-maestro');
            }
        }

        const LIBROS_DATA = [
            {id: 1, t: "Libro 1: Fundamentos de Fe", c: 5, status: "disponible"},
            {id: 2, t: "Libro 2: Vida de Oración", c: 4, status: "bloqueado"},
            {id: 3, t: "Libro 3: Carácter de Cristo", c: 6, status: "bloqueado"}
        ];

        function renderLibros() {
            const container = document.getElementById('lista-libros');
            container.innerHTML = LIBROS_DATA.map(l => `
                <div onclick="verLibro(${l.id})" class="bg-white p-4 rounded-3xl border border-gray-100 flex items-center gap-4 card-shadow active:scale-95 transition-all ${l.status==='bloqueado'?'opacity-50':''}">
                    <div class="w-12 h-12 ${l.status==='bloqueado'?'bg-gray-200':'bg-blue-600'} rounded-2xl flex items-center justify-center text-white font-bold shadow-md">
                        ${l.status==='bloqueado'?'<span class="material-symbols-outlined">lock</span>':l.id}
                    </div>
                    <div class="flex-1">
                        <h4 class="font-bold text-gray-800 text-sm">${l.t}</h4>
                        <p class="text-[10px] font-bold text-gray-400 uppercase">${l.c} capítulos</p>
                    </div>
                    <span class="material-symbols-outlined text-gray-300">chevron_right</span>
                </div>
            `).join('');
        }

        function verLibro(id) {
            const libro = LIBROS_DATA.find(l => l.id === id);
            if(libro.status === 'bloqueado') return alert("Termina el libro anterior para desbloquear este.");
            
            document.getElementById('detalle-titulo').innerText = libro.t;
            const container = document.getElementById('lista-capitulos');
            container.innerHTML = "";
            for(let i=1; i<=libro.c; i++) {
                container.innerHTML += `
                    <div onclick="alert('Ir a capítulo ${i}')" class="p-5 bg-gray-50 rounded-2xl flex justify-between items-center active:bg-blue-50">
                        <span class="font-bold text-gray-700">Capítulo ${i}</span>
                        <span class="material-symbols-outlined text-blue-600">play_circle</span>
                    </div>`;
            }
            cambiarVista('view-libro-detalle');
        }

        function irAHomeAlumno() { cambiarVista('view-home-alumno'); }

        function cerrarSesion() { localStorage.removeItem('usuario_cristo_db'); location.reload(); }

        window.onload = () => {
            const d = localStorage.getItem('usuario_cristo_db');
            if(d) {
                registro = JSON.parse(d);
                finalizarLogin();
            }
        };
    </script>
</body>
</html>
